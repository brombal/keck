{"version":3,"file":"react.js","sources":["src/react.ts"],"sourcesContent":["import { type DeriveEqualFn, disable, focus, observe, reset, unwrap } from 'keck';\nimport { useEffect, useLayoutEffect, useRef, useState } from 'react';\n\nexport function useObserver<TData extends object>(data: TData): TData {\n  const [, forceRerender] = useState({});\n  const ref = useRef<TData>();\n  if (!ref.current) {\n    ref.current = observe(data, () => forceRerender({}));\n  }\n  const state = ref.current;\n\n  // Begin observing on render\n  focus(state);\n  reset(state);\n\n  // Stop observing as soon as component finishes rendering\n  useLayoutEffect(() => {\n    focus(state, false);\n  });\n\n  // Disable callback when component unmounts\n  useEffect(() => {\n    return () => {\n      reset(state);\n      disable(state);\n    };\n  }, [state]);\n\n  return state;\n}\n\n/**\n * Hook that will observe `data`, and only re-render the component when the result of `deriveFn` changes.\n * Returns the result of `deriveFn`.\n */\nexport function useDerived<TData extends object, TDerived>(\n  data: TData,\n  deriveFn: (state: TData) => TDerived,\n  isEqual?: DeriveEqualFn<TDerived>,\n): TDerived {\n  const [, forceRerender] = useState({});\n\n  const deriveResultRef = useRef<TDerived>();\n\n  const ref = useRef<TData>();\n  if (!ref.current) {\n    ref.current = observe(\n      data,\n      () => forceRerender({}),\n      (data): TDerived => {\n        return (deriveResultRef.current = deriveFn(data));\n      },\n      isEqual,\n    );\n  }\n\n  useEffect(() => {\n    return () => disable(ref.current!);\n  }, []);\n\n  return unwrap(deriveResultRef.current!);\n}\n"],"names":[],"mappings":";;;AAGM,SAAU,WAAW,CAAuB,IAAW,EAAA;IAC3D,MAAM,GAAG,aAAa,CAAC,GAAG,QAAQ,CAAC,EAAE,CAAC;AACtC,IAAA,MAAM,GAAG,GAAG,MAAM,EAAS;AAC3B,IAAA,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;AAChB,QAAA,GAAG,CAAC,OAAO,GAAG,OAAO,CAAC,IAAI,EAAE,MAAM,aAAa,CAAC,EAAE,CAAC,CAAC;;AAEtD,IAAA,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO;;IAGzB,KAAK,CAAC,KAAK,CAAC;IACZ,KAAK,CAAC,KAAK,CAAC;;IAGZ,eAAe,CAAC,MAAK;AACnB,QAAA,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC;AACrB,KAAC,CAAC;;IAGF,SAAS,CAAC,MAAK;AACb,QAAA,OAAO,MAAK;YACV,KAAK,CAAC,KAAK,CAAC;YACZ,OAAO,CAAC,KAAK,CAAC;AAChB,SAAC;AACH,KAAC,EAAE,CAAC,KAAK,CAAC,CAAC;AAEX,IAAA,OAAO,KAAK;AACd;AAEA;;;AAGG;SACa,UAAU,CACxB,IAAW,EACX,QAAoC,EACpC,OAAiC,EAAA;IAEjC,MAAM,GAAG,aAAa,CAAC,GAAG,QAAQ,CAAC,EAAE,CAAC;AAEtC,IAAA,MAAM,eAAe,GAAG,MAAM,EAAY;AAE1C,IAAA,MAAM,GAAG,GAAG,MAAM,EAAS;AAC3B,IAAA,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;AAChB,QAAA,GAAG,CAAC,OAAO,GAAG,OAAO,CACnB,IAAI,EACJ,MAAM,aAAa,CAAC,EAAE,CAAC,EACvB,CAAC,IAAI,KAAc;YACjB,QAAQ,eAAe,CAAC,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC;SACjD,EACD,OAAO,CACR;;IAGH,SAAS,CAAC,MAAK;QACb,OAAO,MAAM,OAAO,CAAC,GAAG,CAAC,OAAQ,CAAC;KACnC,EAAE,EAAE,CAAC;AAEN,IAAA,OAAO,MAAM,CAAC,eAAe,CAAC,OAAQ,CAAC;AACzC;;;;"}